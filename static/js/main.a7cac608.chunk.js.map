{"version":3,"sources":["md/home/index.md","md/useEffect/index.md","md/useEffect/index.tsx","router/util.ts","router/routeWithLayout.tsx","components/Layout/Navigator/index.tsx","components/Layout/index.tsx","components/MdView/index.tsx","router/index.tsx","App.tsx","index.tsx"],"names":["module","exports","UseEffectView","React","memo","props","className","useState","count","setCount","useEffect","console","log","handleClick","useCallback","cls","onClick","recoverPath","currentRoute","childRoutes","length","nextRoute","find","route","path","lastChildRoutePath","children","RedirectRoute","routes","pathname","location","redirectUrl","to","homePath","renderRouterWithChildren","parentRoute","childrenRender","map","child","index","CustomerRoute","Layout","layout","layoutProps","RouterComponent","component","restProps","ignoreCache","render","PrivateRoute","rest","PREFIX","Mavigator","matchedPath","routers","useLocation","router","useMemo","includes","useRouterPathMatch","name","key","title","MdView","md","view","process","dangerouslySetInnerHTML","__html","WEB_ROOT","getPath","home","RootRouter","undefined","App","ReactDOM","document","getElementById"],"mappings":"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","file":"static/js/main.a7cac608.chunk.js","sourcesContent":["// Module\nvar code = \"<p>这个博客主要用来记录 react 学习中遇到的点点滴滴，巩固知识点。</p> <hr> \";\n// Exports\nmodule.exports = code;","// Module\nvar code = \"<h1 id=\\\"useeffect、uselayouteffect\\\">useEffect、useLayoutEffect</h1> <hr> <p>useEffect 的作用和 componentDidMount 以及 componentDidUpdate 有点类似，只不过 useEffect 的粒度更细，可以在 useEffect 中控制一个流程的发起和销毁。具体用法可以查看<a href=\\\"https://zh-hans.reactjs.org/docs/hooks-effect.html\\\">官网</a>,这里主要讨论下 useEffect 和 componentDidMount/componentDidUpdate 的区别 以及 useEffect 和 useLayoutEffect 的区别。</p> <h2 id=\\\"useeffect-vs-componentdidmountcomponentdidupdate\\\">useEffect vs componentDidMount/componentDidUpdate</h2> <p>componentDidMount 是 class 组件初次渲染结束时执行的生命周期函数，是在 react 的 commit 阶段，紧接着组件渲染完后执行的，会阻塞浏览器的渲染，如果在其中执行耗时的任务，那在耗时任务结束前，页面是看不到更新的，componentDidUpdate 和 componentDidMount 的行为差不多，只是执行的时机不是初次渲染。</p> <p>useEffect 有三个重要的组成，处理函数、依赖、销毁函数（处理函数返回的函数），每当依赖发生变化都会先执行上一次生成的销毁函数再执行新的处理函数。</p> <p><strong>useEffect 不会阻塞浏览器的渲染</strong>，因为 useEffect 是等到 commit 完成后，再在另一个宏任务中执行的，这个宏任务是通过 messageChannel 的 postMessage 触发的 j 具体细节可查看 react schedule 模块的实现。</p> <h2 id=\\\"useeffect-vs-uselayouteffect\\\">useEffect vs useLayoutEffect</h2> <p>事实上百分之 99%的场景使用 useEffect 和 useLayoutEffect 的效果是一样的, 不同点是，useLayoutEffect 的表现和 componentDidUpdate 一样，会阻塞浏览器的渲染,具体可参考<a href=\\\"https://codesandbox.io/s/useeffect-vs-uselayouteffect-gtvim\\\">useEffect</a>,可以发现使用 useEffect 时红色数字 1 会一闪而过，useLayoutEffect 不会出现这种现象。</p> <p><img src=\\\"/react-markdown/assets/useEffect.png\\\" alt=\\\"github\\\" width=\\\"80%\\\" style=\\\"margin:auto;display:block\\\"></p> \";\n// Exports\nmodule.exports = code;","import React, { useCallback, useEffect, useState } from 'react';\nimport cls from 'classnames';\n\nconst PREFIX = 'useEffectView';\n\ninterface IProps {\n  className?: string;\n}\n\nconst UseEffectView: React.FC<IProps> = React.memo(function useEffectView(props) {\n  const { className } = props;\n  const [count, setCount] = useState<number>(0);\n  useEffect(() => {\n    console.log(count);\n    return () => {\n      console.log('unmount effect');\n    };\n  }, [count]);\n\n  const handleClick = useCallback(() => {\n    setCount(count + 1);\n  }, [count]);\n  return (\n    <div className={cls(`${PREFIX}`, className)} onClick={handleClick}>\n      {count}\n    </div>\n  );\n});\n\nexport default UseEffectView;\n","import { IRoute } from './interface';\nimport { find } from 'lodash';\n\nexport const recoverPath: (currentRoute?: IRoute, childRoutes?: IRoute[]) => string = (\n  currentRoute,\n  childRoutes,\n) => {\n  if (currentRoute && childRoutes?.length) {\n    const matchedChildRoute = find(\n      childRoutes,\n      (route) => route.path === currentRoute?.lastChildRoutePath,\n    );\n\n    const nextRoute = matchedChildRoute || childRoutes[0];\n    return recoverPath(nextRoute, nextRoute.children);\n  }\n  return currentRoute?.path || '';\n};\n","import { IRoute } from './interface';\nimport { Redirect, Route, RouteComponentProps, RouteProps, Switch } from 'react-router-dom';\nimport { map } from 'lodash';\nimport { recoverPath } from './util';\nimport React from 'react';\nimport { homePath } from '.';\n\ntype IRouteWithLayoutProps = Omit<RouteProps, 'component' | 'render' | 'children'> & {\n  childrenRender: React.ReactNode;\n  childRoutes?: IRoute[];\n  parentRoute?: IRoute;\n  route?: IRoute;\n} & Partial<IRoute>;\n\nconst RedirectRoute: React.FC<\n  Partial<RouteComponentProps> & {\n    routes?: IRoute[];\n    route?: IRoute;\n  }\n> = React.memo(function ({ route, routes, location }) {\n  const { pathname } = location || {};\n  const redirectUrl = recoverPath(route, routes);\n  if (redirectUrl !== pathname) {\n    return <Redirect to={redirectUrl} />;\n  }\n  return <Redirect to={homePath} />;\n});\n\nexport const renderRouterWithChildren = (\n  route: IRoute | undefined,\n  children?: IRoute[],\n  parentRoute?: IRoute,\n) => {\n  const childrenRender = children ? (\n    <Switch>\n      {map(children, (child, index) => {\n        return renderRouterWithChildren(child, child.children, route);\n      })}\n      <RedirectRoute routes={children} route={route} />\n    </Switch>\n  ) : null;\n\n  return (\n    <CustomerRoute\n      childrenRender={childrenRender}\n      {...route}\n      route={route}\n      parentRoute={parentRoute}\n      childRoutes={children}\n    />\n  );\n};\n\nconst CustomerRoute: React.FC<IRouteWithLayoutProps> = React.memo(function CustomerRoute(props) {\n  const {\n    childrenRender,\n    route,\n    parentRoute,\n    childRoutes,\n    layout: Layout,\n    layoutProps,\n    children,\n    component: RouterComponent,\n    ...restProps\n  } = props;\n\n  if (parentRoute && !parentRoute.ignoreCache) {\n    parentRoute.lastChildRoutePath = route?.path;\n  }\n  if (!route) {\n    return childrenRender as React.ReactElement;\n  }\n\n  if (!childRoutes) {\n    if (RouterComponent) {\n      if (Layout) {\n        return (\n          <PrivateRoute\n            {...restProps}\n            render={() => (\n              <Layout route={route} {...layoutProps}>\n                <RouterComponent {...restProps} />\n              </Layout>\n            )}\n          />\n        );\n      }\n      return <PrivateRoute {...restProps} render={() => <RouterComponent {...restProps} />} />;\n    }\n  }\n\n  if (childRoutes) {\n    if (Layout) {\n      return (\n        <PrivateRoute\n          {...restProps}\n          render={() => (\n            <Layout childRoutes={childRoutes} route={route} {...layoutProps}>\n              {childrenRender}\n            </Layout>\n          )}\n        />\n      );\n    }\n  }\n  return childrenRender as React.ReactElement;\n});\ntype PrivateRouteProps = Required<Pick<RouteProps, 'render'>> &\n  Omit<RouteProps, 'component' | 'render'>;\nexport const PrivateRoute = ({ render, ...rest }: PrivateRouteProps) => {\n  return <Route {...rest} render={render} />;\n};\n","import { Link } from 'react-router-dom';\nimport { find } from 'lodash';\nimport { useLocation } from 'react-router';\nimport React, { useMemo } from 'react';\nimport cls from 'classnames';\nimport './index.less';\nimport { IRoute } from '../../../router/interface';\n\nconst PREFIX = 'Mavigator';\n\ninterface IProps {\n  className?: string;\n  childRoutes: IRoute[];\n}\n\nconst useRouterPathMatch = (routers: IRoute[]) => {\n  const location = useLocation();\n  const router = useMemo(() => {\n    return find(routers, (router) => location.pathname.includes(router.path));\n  }, [location.pathname, routers]);\n  return router?.path;\n};\n\nconst Mavigator: React.FC<IProps> = React.memo(function AppThirdNavigator(props) {\n  const { className, childRoutes } = props;\n  const matchedPath = useRouterPathMatch(childRoutes);\n\n  return (\n    <div className={cls(`${PREFIX}`, className)}>\n      {childRoutes.map((router) =>\n        matchedPath === router.path ? (\n          <span className={cls(`${PREFIX}-item`, 'is-active')}>\n            {router.name}\n            <div className={`${PREFIX}-activeBar`} />\n          </span>\n        ) : (\n          <Link className={cls(`${PREFIX}-item`)} key={router.path} to={router.path}>\n            {router.name}\n            <div className={`${PREFIX}-activeBar`} />\n          </Link>\n        ),\n      )}\n    </div>\n  );\n});\n\nexport default Mavigator;\n","import React from 'react';\nimport cls from 'classnames';\nimport './index.less';\nimport { IRoute } from '../../router/interface';\nimport Mavigator from './Navigator';\n\nconst PREFIX = 'Layout';\n\ninterface IProps {\n  title?: React.ReactNode;\n  route?: IRoute;\n  childRoutes: IRoute[];\n}\n\nconst Layout: React.FC<IProps> = React.memo(function Layout(props) {\n  const { title, childRoutes, children } = props;\n  return (\n    <div className={cls(`${PREFIX}`)}>\n      <div className={`${PREFIX}-head`}>\n        <span className={`${PREFIX}-headTitle`}>{title}</span>\n      </div>\n      <div className={`${PREFIX}-body`}>\n        <div className={`${PREFIX}-bodyLeft`}>\n          <Mavigator childRoutes={childRoutes} />\n        </div>\n        <div className={`${PREFIX}-bodyRight`}>{children}</div>\n      </div>\n    </div>\n  );\n});\n\nexport default Layout;\n","import React from 'react';\nimport cls from 'classnames';\nimport './index.less';\n\nconst PREFIX = 'MdView';\n\ninterface IProps {\n  className?: string;\n  md: string;\n  view?: React.ReactNode;\n}\n\nconst MdView: React.FC<IProps> = React.memo(function MdView(props) {\n  const isDevelopment = process.env.NODE_ENV === 'development';\n  const { className, md, view } = props;\n  return (\n    <div className={cls(`${PREFIX}`, className)}>\n      {isDevelopment && <div className={`${PREFIX}-body`}>{view}</div>}\n      <div className={`${PREFIX}-md`} dangerouslySetInnerHTML={{ __html: md }}></div>\n    </div>\n  );\n});\n\nexport default MdView;\n","import home from '../md/home/index.md';\nimport useEffect from '../md/useEffect/index.md';\nimport UseEffectView from '../md/useEffect';\nimport { Switch, Redirect, BrowserRouter } from 'react-router-dom';\nimport { renderRouterWithChildren } from './routeWithLayout';\nimport Layout from '../components/Layout';\nimport React from 'react';\nimport MdView from '../components/MdView';\nimport { IRoute } from './interface';\n\nconst WEB_ROOT = process.env.WEB_ROOT || '/';\n\nfunction getPath(path: string) {\n  return `${WEB_ROOT}${path}`;\n}\n\nexport const homePath = getPath('/home');\nconst routes: IRoute[] = [\n  {\n    path: WEB_ROOT,\n    layout: Layout,\n    layoutProps: { title: 'react 解析' },\n    ignoreCache: true,\n    children: [\n      {\n        path: homePath,\n        name: 'home',\n        component: () => <MdView md={home} />,\n      },\n      {\n        path: getPath('/useEffect'),\n        name: 'useEffect',\n        component: () => <MdView md={useEffect} view={<UseEffectView />} />,\n      },\n    ],\n  },\n];\n\nconst RootRouter = () => {\n  return (\n    <BrowserRouter>\n      <Switch>\n        {renderRouterWithChildren(undefined, routes)}\n        <Redirect to=\"/home\" />\n      </Switch>\n    </BrowserRouter>\n  );\n};\n\nexport default RootRouter;\n","import React from 'react';\nimport RootRouter from './router';\nimport './index.less';\n\nconst App: React.FC = React.memo(function App(props) {\n  return <RootRouter />;\n});\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}